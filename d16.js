const input = `\\....-./...............\\.............-../...|......../........../...............|......................./.....
\\.......\\..-.\\/|..........|......|./..........|.../..................-...................................|....
.|........................................./...|...........................-.........../..............\\....../
.-............................|....-./|.........-................/.-./................|...|/..............-...
/....................\\..........\\.//.....-..-.........................../\\................|.....-/...\\........
...........................|..|..\\...-......\\............................../.-...|...-....../...-./.....\\.....
..|......-\\.....\\.........\\................../...|...|..\\-........................................./..........
............../..............|......../.....................\\................/|.....\\...........\\...-.........
.....-................./-.\\..\\..........................-.\\|.........../..................../.|............-..
/..........|.........-....-.............|....................................../...\\./................-.....-.
../|.....\\|...|./.................../....../...../\\/........\\.......|./..-...................................|
.-./......|.........|.......\\....\\-..........................-..\\/.../.....-.../...|....\\...........-...../...
....................|................................../....-.......\\......|..-...............................
......-............../....|..........-..../..........--.................../..|...|...\\.............-....\\...|.
.............|...................-......-...............-..|.-..-.........|..\\......|......|......./..........
......-....|.....\\.................|\\......................./..|.........-....|.....\\.....|........-.........|
.....\\............\\..\\...................|.../...\\.....-.-.\\.......|....../\\.........|........................
.........\\./|\\........................./........../............................../..\\...-....................\\
....|.|...........||......\\........\\...................-......................|.....-.-.....\\.................
.....|.........\\............-..................../\\...|...|../..........-/..-..-.........|.../................
............|...|.............\\.-....................|.....................\\............\\.............-../....
................././......\\................./..\\./\\..............\\./.......|../......|............|..|......|.
...|...../........../..../.............|\\...........|................./.........-......./.....................
../.|......-...........................|........-......|..\\..........|.....\\.../.............../..............
.........................|.............................\\...........-..../.................-............/.....\\
.....\\.....|......./.\\........../......................|....................................../......\\..../..|
...\\............|........\\........\\........../................./..........-....................|\\.............
........................../............................./..../..../..../......|...../..\\......\\.........-.|...
............-.........|..................-...-......\\.........\\............|.|.\\/....././|...|................
......./....|.................................................|......../..-./..../..|.........................
./....-..........-........-......-.-.......-..........|-..\\......|...../........................\\.........../.
.....................|../|.-...........-....\\..\\.................|........-............|...|.|................
..../..........||\\....................-...........|...............-....../........\\......\\|..............\\....
.......\\...|..........|.|.\\....../.....|..|...........|..........-........../..\\...-.............-............
................\\........../.../...-.....\\.....|.-\\......\\.................................-.....|............
......-.....|........\\.............-........./....../.............|..........-.|..........|......\\..-.........
.......................................\\..\\-..........-................../........-................./.........
../.............................-..........-........./..-.................../...../.....|......\\..............
.....\\........\\......-....\\..........................\\/..................\\......\\..............\\|....../......
................./...../....|......../........../..-.....-......../........................................./.
...................|..\\...|....\\..............|..........|.......|..............//\\......\\.......\\...\\..-.....
.........\\........-.............\\........\\....................-.............|..............|\\...|..-..\\.......
..|--../.......\\.........|.\\.......-.........-.........../..|.....-\\......-...|.........................-.\\...
........|...............................-..........................-|.-.|\\\\|\\.........-............../........
.......................-...\\...-.....-.............|..........-..-.\\.....--.../........./......../...........\\
..-..|..|.............................|........................|......................\\...................\\|..
....\\...............\\.\\.|............................-|......-................\\......|......|...............-.
..../\\....\\..................\\.............\\.......\\...............|.-..../.................../.\\....\\........
.......................|..........\\.....-.|........./........../.....|...................../.|/...............
-...........||.........|........||.....................................................................-....\\.
..\\...../.........-......\\....................................../........................|..|...-...|....|.../
..-......\\............................/.....-................./..-..........\\..-.|...........|.-......|..\\...\\
.........................\\...\\................\\.................--......../.........|...|........|............
\\.....\\../..........|.................-............-..............|..................\\................\\....-..
....................-..........|....|..|-.................|.\\.|/../....................|......................
................/|../.../.\\...../.\\../...........|..\\........./....\\.-...................-|......./..........\\
.....\\.........|..................\\....../.........-.....\\......\\.....|....|../|.........|....................
..............-..........././...................|..|.....|.\\/....-............|..../....-.....................
....../.-..........................\\..-..-........../............./.....|............/.......|.\\.......-|....|
.....\\.....................|.........../....-/............-|................/...../............./.............
...............................|.........\\.......\\.......|....|..................|................./..........
.........../.........-........................................-/.......................\\............-.........
..............................................-./......./.\\........./......../...........\\..|..............\\\\.
...........-..|........-.............\\.-|............./...-..................|./.....|................../.\\...
........|..\\..\\|...........-..|........-.......\\..|.............-....\\........./..|../....-\\.........../......
/.....|......|...............||.\\|.............-..\\.-....................../................../...........\\...
../.-./................-................\\.....\\....................\\-...................|-..\\.................
....\\.........................-.........|.|\\......\\../.................\\-....../...|.....|\\.|...........\\.....
......\\.........|.../.......\\...-....../.....|.....-..-\\...................\\\\.-.-||...........................
....-..../...|.......\\............\\.|...\\.................\\....../..../..|.\\......|\\|.|.......................
.../...........\\...................../........................../......-......................................
.-............./......\\......../.........|/-........-....................................-.....-..............
/................../...........-.........-................................\\...................................
...../...../...................../....\\..................................|../.....-................|..........
.\\.....\\.-.....-...\\.\\-......./..........-.-....................-....................\\.....\\...-......-.......
..........................|......-........../....|..........\\.......................................\\.........
.................|\\....\\.............../\\.............-.\\.-.................-...........-..|......./..........
..........|...|.-...|............./..|............-.................|............\\...|.|.\\....................
.........../-....\\./....-................\\..-........\\..............................-.........\\.....|.........
.............|..........\\.................-.................\\\\.........-/.................-|-.........-.......
......................./...........................\\.................|...-.....\\......\\.........../.......|...
....-.....-.......|..--.......\\....\\..................................................../...........\\.........
...........................-.\\..\\......................................\\......|.......-........-.....|........
..-.......\\............................../...................|..-.....................-......./..\\.......-.-..
....|.....-./.................\\......./...........|.............................-....|........-............-..
.....-...............|...........-.......|/..\\-.............|-|........\\...........|./...../..................
|...................-../../.....|./..................|........|....\\..../.....|....................../......./
...............-./\\.......|.......|./....................-....\\...................-.......................|...
.../..........\\...........|.....-..../..-..-.......................|.......|.....-./......................|...
......-..\\..\\........................................|...-................................|.............|.....
...........|............-\\.........../..\\....../.....\\....../...........|...........|.../............\\........
|....-..........-.|...........-..-..................-..\\......\\.......--............|.................|\\\\.....
.........../|.-..........|...\\.|./......../...........\\...........\\/....-..........\\...................../....
.........................-...../.....-./.-............................\\...........-...............\\.\\/....../.
..../........-...................../............../....\\............................./............../.../.....
..................-/...-......................|....................\\......\\..../.........-......./............
....../....................-....\\...-.-.....//...|.....................\\.........\\............\\.-....-../.....
......-.....\\......|.|........................|.................-............../......./......................
....../......../.........\\..................|...|..................................|..-..........|....\\.......
..........\\.../......................\\.......\\/......................-....|.........................../.\\.....
.........-..............-.|...../../............................\\../...............-.............\\......../...
...\\............\\......................\\.\\......\\........\\............\\...-.....|./...-.............|....|.-..
/........................../.-..\\|.-........../.-............./../.........-.../..............................
|....|.\\.....-..|....|....../........|.|...........\\-......................|......|..........................|
.......................\\...........................................\\..........|.............-.../.............
.\\.........|.............|................................\\..................|||........\\...-|................
..........\\...............\\.....................-.....|....................-..........\\|..................|.|.
...|...........\\.|......|/.-../....../.................../......\\.........................|\\.\\..............\\.
..........................................................\\......................./.....--..........|...-..\\..
........-/...-................/........\\..........................\\..../........................\\........-....`

const input2 = `.|...\\....
|.-.\\.....
.....|-...
........|.
..........
.........\\
..../.\\\\..
.-.-/..|..
.|....-|.\\
..//.|....`


class Grid{
  constructor(input){
    this.grid = input.split('\n').map(row => row.split(''))
    this.width = this.grid[0].length
    this.height = this.grid.length
  }
  
  get(x,y){
    return (this.grid[y] || [])[x]
  }

  getNext(x,y,dir){
    switch(dir){
      case 'U':
        return {x, y: y-1}
      case 'D':
        return {x, y: y+1}
      case 'L':
        return {x: x-1, y}
      case 'R':
        return {x: x+1, y}
    }
  }

  reflexion(value, dir){
    switch(value){
      case '\\':
        switch(dir){
          case 'U':
            return ['L']
          case 'D':
            return ['R']
          case 'L':
            return ['U']
          case 'R':
            return ['D']
        }
      case '/':
        switch(dir){
          case 'U':
            return ['R']
          case 'D':
            return ['L']
          case 'L':
            return ['D']
          case 'R':
            return ['U']
        }
      case '-':
        switch(dir){
          case 'U':
          case 'D':
            return ['L', 'R']
          case 'L':
          case 'R':
            return [dir]
        }
      case '|':
        switch(dir){
          case 'U':
          case 'D':
            return [dir]
          case 'L':
          case 'R':
            return ['U', 'D']
        }
      case '.':
        return [dir]
    }
  }
}

const grid = new Grid(input)

function calc( start){

  const beams = [start]
  const history = {}
  const actives = {}

  while(beams.length){
    const beam = beams.shift()
    const value = grid.get(beam.x, beam.y)

    if(value === undefined)
      continue

    const key = `${beam.x}-${beam.y}`
    actives[key] = true

    const key2 = `${beam.x}-${beam.y}-${beam.dir}`
    if(history[key2]){
      // console.log('loop', key2)
      continue
    } else {
      history[key2] = true
    }
    
    const dirs = grid.reflexion(value, beam.dir)
    // console.log("+++", beam, value, dirs)
    dirs.forEach(dir => {
      const next = grid.getNext(beam.x, beam.y, dir)
      beams.push({...next, dir})
    })
  }

  // //print actives
  // for( let y = 0; y < grid.height; y++){
  //   let line = ''
  //   for( let x = 0; x < grid.width; x++){
  //     const key = `${x}-${y}`
  //     line += actives[key] ? '#' : '.'
  //   }
  //   console.log(line)
  // }

  // console.log(Object.keys(actives).length)
  return Object.keys(actives).length
}

//part1
console.log(calc({ x: 0, y: 0, dir: 'R' }))

//part2
let max = 0
for(y=0; y<= grid.height; y++){
  max = Math.max(
    max,
    calc({ x: 0, y, dir: 'R' }),
    calc({ x: grid.width-1, y, dir: 'L' })
  )
}
for(x=0; x<= grid.width; x++){
  max = Math.max(
    max,
    calc({ x, y: 0, dir: 'D' }),
    calc({ x, y: grid.height-1, dir: 'U' })
  )
}
console.log(max)
